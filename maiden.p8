pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- maiden
-- a simple rpg

t = 0
th = 64 -- text/upper half
oh = 66 -- option/lower half

text_buff = {}
page_i = {}
actions = {}
game_state = "title"

function dr_split_screen()
 cls(0)
 rect(1,1,126,th-1,7)
 rect(3,3,124,th-3,6)
	local y = 5
	if game_state == "title" then
	 dr_title()
 	title_actions()
	else
		for i=1,#text_buff do
 		if y < th-8 then
	 		print(text_buff[i],10,y,7)
		 	y += 8
		 end
	 end
	end
 for i=1, #actions do
	 local opt_y = oh + (i-1)*10
	 if i == selected then
		 spr(1,2,opt_y-2) -- draw cursor
	 end
	 print(actions[i].label, 15,opt_y,7)
 end
 if #text_buff > 4 then
	 spr(2,110,55)
 end
end

function handle_text_input()
	if btnp(‚ùé) then
		if page_i < #text_buff then
			page_i += 1
		else
		 game_state = "choose_action"
		end
	end
end

function enter_capitol()
	game_state = "text_scroll"
	text_buff = {
	 "you approach the grand gates",
	 "of the capitol. guards eye",
	 "you from top to bottom...",
	 "(rep: "..party[1].rep..")"
	}
	if party[1].rep < 5 then
		add(text_buff, "they deny you entry!")
		actions = {{label="leave",func=exit_location}}
	else
	 add(text_buff, "the gates creak open!")
	 actions = {
	 	action_list[1],
	 	action_list[2],
	 	action_list[3]
	 }
	end
	page_i = 1
end

function _draw()
	cls()
	dr_split_screen()
	
end

function _update()
 t += 1
	if game_state== "text_scroll" then
	 handle_text_input()
 elseif game_state == "choose_action" then
 	handle_action_selected()
 end
end

function dr_title()
	rectfill(4,4,123,19,1)
	rectfill(4,20,123,35,12)
	rectfill(4,36,123,43,11)
	rectfill(4,44,123,60,3)
	for i=0,14 do
	 spr(18,4+(i*8),12)
	 spr(19,4+(i*8),36)
	end
	for i=0,6 do
	 --	spr(34,4+(i*16),45,2,1)
			spr(34,4+(i*16),53,2,1)
 end
	spr(34,116,53)
 spr(16,80,26,2,2)
 spr(16,96,26,2,2,true)
 spr(20,22,18,5,1)
 spr(36,32,28,5,1)
 spr(9,6,29,4,4)
end

function title_actions()
	actions={
		{label="start new game", func=start_came},
	}
 selected = 1	
end

function handle_action_selected()
	
end

function handle_text_input()
	if
end
-->8
-- action list

function add_action(_l,_f)
	add(action_list,{label=_l,func=_f})
end

action_list = {}

add_action("find new quests",find_quests)
add_action("visit market",open_market)

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000009990c00000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700099999999c00000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700044449994dcc0ccd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000099400ddcdd0000000000000000000000000000000000000000000000000000000000000044422200000000000000000000000000000000000000
0000000000004400000d000000000000000000000000000000000000000000000000000000000000444444442220000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000004444444222220000000000000000000000000000000000000
00000000000000001c1c1c1cbbbbbbbba9a90a99900a000a9990a99900a99990a9900a9900000004444222222222000000000000000000000000000000000000
0000000000000000111111113b3b3b3b0a99a99900a9900094000944900940900999094000000044442f4f4f4f4f000000000000000000000000000000000000
0000000000000000c1c1c1c1bbbbbbbb094494490a9499009400094049094000094999400000004442f4f4f4f4f4f00000000000000000000000000000000000
50505000000000001c1c1c1cb3b3b3b30940404909404900940009404909990009409940000004444f4f4f4f4f4f400000000000000000000000000000000000
1555100000000000c1c1c1c13b3b3b3b09400049099999009400094049094400094009400000044444f4f4eef4f4ff0000000000000000000000000000000000
1111100000000000ccccccccb3b3b3b30940004909444900940009404909400009400940000004442f4f4effef4fff0000000000000000000000000000000000
01110000000055551c1c1c1c33333333094000490940490094000940490940a0094009400000044424f4fefef4ff440000000000000000000000000000000000
0151555555555151cccccccc3b3b3b3ba9400049a940499a9990a99990a99990a940a949000000442f4f2efeeffeee0000000000000000000000000000000000
015555551515555533333333333333b37ffff507f0f507ffff507ffff507ffff500000000000044442f4f2efffff110000000000000000000000000000000000
05515555515551113133b333313331b3f555510f50f10f555510f555510f55551000000000000444422f4f2effffff0000000000000000000000000000000000
055155551555121233333b3333333333f500510f50f10f500000f50000000f50000000000000044442e4f4feffffff0000000000000000000000000000000000
051151555151221433331b3b33b33333f500510f50f10f55f00001ff50000f500000000000000044222f4f4efffff00000000000000000000000000000000000
0551555515512414333b331b333b3333f5ff510f50f10f500000001151000f50000000000000000422e2e2eeeffff00000000000000000000000000000000000
0511515511512412331b3333331b3333f555510f5f510f555510f55551000f50000000000000000222eeeeeeeeff000000000000000000000000000000000000
05515555155124143333313333333b335111150511110511111051111000051000000000000000222eeeeee22200000000000000000000000000000000000000
05115555115111113333333333331b3300000000000000000000000000000000000000000000000eeeeeeeee2222000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000077cccccccccc22200000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000007ccccc7cccccccc1d00000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000007ccccccccccccccdd766000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000007cc7cccccccccccd76666660000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000007cc7cccdcccccccd766555556000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000007cc7ccccdccccc1d665551155500000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000007cccccccdccccc1d655111115500000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000007ccccccc1ddccc11d551111115500000000000000000000000000000
